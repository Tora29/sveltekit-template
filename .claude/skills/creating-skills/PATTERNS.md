# 共通パターン集

## 1. 段階的開示パターン

SKILL.mdは概要のみ、詳細は別ファイルに。

**いつ使うか**: SKILL.mdが500行を超えそうなとき

**構造**:
```
skill/
├── SKILL.md           # 概要（500行以下）
├── REFERENCE.md       # 詳細なリファレンス
├── EXAMPLES.md        # 使用例
└── ADVANCED.md        # 高度な機能
```

**SKILL.md での参照方法**:
```markdown
## 高度な機能

**フォーム入力**: [FORMS.md](FORMS.md) を参照
**APIリファレンス**: [REFERENCE.md](REFERENCE.md) を参照
**例**: [EXAMPLES.md](EXAMPLES.md) を参照
```

**重要**: 参照は1レベル深さまで。ネストした参照は避ける。

## 2. ワークフローパターン

複雑なタスクをチェックリスト形式で管理。

**いつ使うか**: 3ステップ以上の複雑なタスク

````markdown
## ワークフロー

このチェックリストをコピーして進行状況を追跡：

```
タスク進捗：
- [ ] ステップ1：入力を分析する
- [ ] ステップ2：計画を作成する
- [ ] ステップ3：計画を検証する
- [ ] ステップ4：実行する
- [ ] ステップ5：結果を確認する
```

### ステップ1：入力を分析する
（詳細な指示）

### ステップ2：計画を作成する
（詳細な指示）

...
````

## 3. フィードバックループパターン

検証→修正→繰り返し。

**いつ使うか**: 品質が重要なタスク

````markdown
## 編集プロセス

1. 変更を加える
2. **すぐに検証**: `python scripts/validate.py`
3. 検証が失敗した場合：
   - エラーメッセージを確認
   - 問題を修正
   - 再度検証
4. **検証が成功したときのみ続行**
5. 最終確認を実行
````

## 4. 条件付きワークフローパターン

決定ポイントで分岐。

**いつ使うか**: 状況によって異なるアプローチが必要なとき

```markdown
## ワークフロー

1. タイプを判定：

   **新規作成？** → 「作成ワークフロー」へ
   **既存編集？** → 「編集ワークフロー」へ

2. 作成ワークフロー：
   - ライブラリを使用
   - 最初から構築
   - 形式にエクスポート

3. 編集ワークフロー：
   - 既存ファイルを解凍
   - 直接変更
   - 各変更後に検証
```

## 5. テンプレートパターン

出力形式を指定。

**厳密な要件の場合**:
````markdown
## レポート構造

常にこの形式を使用：

```markdown
# [タイトル]

## 概要
[1段落の概要]

## 主要な発見
- 発見1
- 発見2
- 発見3

## 推奨事項
1. 推奨1
2. 推奨2
```
````

**柔軟なガイダンスの場合**:
````markdown
## レポート構造

デフォルト形式（必要に応じて調整可）：

```markdown
# [タイトル]

## 概要
[概要]

## 主要な発見
[発見に基づいて適応]

## 推奨事項
[コンテキストに合わせてカスタマイズ]
```
````

## 6. 例パターン

入出力ペアで期待を示す。

````markdown
## コミットメッセージ形式

これらの例に従って生成：

**例1：**
入力：ユーザー認証を追加
出力：
```
feat(auth): JWT ベースの認証を実装

ログインエンドポイントとトークン検証ミドルウェアを追加
```

**例2：**
入力：日付表示のバグを修正
出力：
```
fix(reports): タイムゾーン変換での日付フォーマットを修正

レポート生成全体でUTCタイムスタンプを一貫して使用
```
````

## 7. 検証可能な中間出力パターン

実行前に計画を検証。

**いつ使うか**: バッチ操作、破壊的変更、高リスク操作

```markdown
## ワークフロー

1. 分析：入力を読み取り
2. **計画ファイルを作成**: `changes.json`
3. **計画を検証**: `python scripts/validate.py changes.json`
4. 検証成功後、実行
5. 結果を確認
```

**利点**:
- 早期にエラーを発見
- 機械的に検証可能
- 可逆的な計画作成
